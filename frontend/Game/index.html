<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YUBI SOCCER - ã‚¿ã‚¤ãƒˆãƒ«</title>
    <style>
        /* å…¨ä½“ãƒªã‚»ãƒƒãƒˆã¨åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ */
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‚³ãƒ³ãƒ†ãƒŠ */
        #title-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-image: url('./Images/yubi_title.PNG'); /* âš ï¸ ã‚¿ã‚¤ãƒˆãƒ«ç”»åƒãƒ‘ã‚¹ */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ------------------ ãƒœã‚¿ãƒ³ã®å½“ãŸã‚Šåˆ¤å®š (ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢) ------------------ */

        .title-button-overlay {
            position: absolute;
            background: rgba(0, 0, 0, 0); /* å®Œå…¨é€æ˜ãªå½“ãŸã‚Šåˆ¤å®š */
            cursor: pointer;
            border: none;
            padding: 0;
            z-index: 10; 
        }

        /* ã€ŒéŠã¶ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™ (å†èª¿æ•´å¾Œ) */
        #play-button {
            top: 24%; /* ã•ã‚‰ã«ä¸Šã¸ */
            left: 7%;
            width: 25%; /* æ¨ªå¹…ã‚’å°ã•ã */
            height: 20%;
        }

        /* ã€ŒéŠã³æ–¹ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™ (å†èª¿æ•´å¾Œ) */
        #how-to-play-button {
            top: 47%; /* é«˜ã•ç¶­æŒ */
            left: 9%;
            width: 26%; /* æ¨ªå¹…ã‚’å°ã•ã */
            height: 20%;
        }

        /* ã€ŒæŠ€è¡“è§£èª¬ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™ (ä»¥å‰ã®å€¤ã«æˆ»ã™) */
        #tech-info-button {
            top: 73%; /* ä»¥å‰ã®å€¤ */
            left: 12%;
            width: 25%; /* ä»¥å‰ã®å€¤ */
            height: 20%;
        }

        /* ------------------ ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« ------------------ */

        .modal {
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            position: fixed;
            z-index: 20;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* åŠé€æ˜ã®é»’èƒŒæ™¯ */
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            cursor: pointer; /* ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ */
        }

        .modal-content-wrapper {
            position: relative;
            width: 90%; 
            max-width: 900px; /* åŸºæœ¬ã®æœ€å¤§å¹… */
            background-size: contain; 
            background-position: center;
            background-repeat: no-repeat;
            display: flex; 
            justify-content: center;
            align-items: center;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            cursor: default; /* ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã§ã¯ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™ */
        }
        
        .close-button {
            position: absolute;
            top: 15px; 
            right: 30px;
            font-size: 40px; 
            font-weight: bold;
            color: white; 
            cursor: pointer;
            z-index: 30; 
        }

        .close-button:hover {
            opacity: 0.8;
        }


        /* ------------------ 1. éŠã¶ãƒ¢ãƒ¼ãƒ€ãƒ« (mordal_match.PNG) ------------------ */
        #play-modal-content-wrapper {
            background-image: url('./Images/mordal_match.PNG'); /* âš ï¸ éŠã¶ãƒ¢ãƒ¼ãƒ€ãƒ«ç”»åƒãƒ‘ã‚¹ */
            aspect-ratio: 1.5; 
        }

        .play-modal-option-overlay {
            position: absolute;
            background: rgba(255, 0, 0, 0); /* å®Œå…¨é€æ˜ãªå½“ãŸã‚Šåˆ¤å®š */
            cursor: pointer;
            border: none;
            padding: 0;
            z-index: 10;
            /* :hover ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã€å®Œå…¨ã«ä¸å¯è¦–åŒ– */
        }


        /* ã€Œèª°ã‹ã¨ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™ (å†èª¿æ•´) */
        #play-option-public {
            top: 25%;
            left: 10%;
            width: 37%;
            height: 55%;
        }

        /* ã€Œå°‚ç”¨éƒ¨å±‹ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™ (å†èª¿æ•´) */
        #play-option-private {
            top: 25%;
            left: 53%;
            width: 37%;
            height: 55%;
        }


        /* ------------------ 2. ãƒ«ãƒ¼ãƒ ä½œæˆ/å‚åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« (match_in.PNG) ------------------ */
        #room-modal-content-wrapper {
            background-image: url('./Images/match_in.PNG'); /* âš ï¸ ãƒ«ãƒ¼ãƒ ä½œæˆ/å‚åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ç”»åƒãƒ‘ã‚¹ */
            padding: 30px 0 0; 
            aspect-ratio: 1; 
            max-width: 900px; /* **ã‚µã‚¤ã‚ºã‚’ play-modal ã¨çµ±ä¸€** */
        }
        
        .room-modal-button-overlay {
            position: absolute;
            background: rgba(0, 255, 0, 0); /* é€æ˜ãªå½“ãŸã‚Šåˆ¤å®š */
            cursor: pointer;
            border: none;
            padding: 0;
            z-index: 10;
        }
        
        /* ã€Œéƒ¨å±‹ã‚’ä½œã‚‹ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™ (match_in.PNGå†…) */
        #room-create-button {
            top: 25%;
            left: 5%;
            width: 45%;
            height: 60%;
        }

        /* ã€Œéƒ¨å±‹ã«å…¥ã‚‹ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™ (match_in.PNGå†…) */
        #room-join-button {
            top: 25%;
            left: 50%;
            width: 45%;
            height: 60%;
        }

        #join-input-area {
            position: absolute;
            top: 70%; 
            left: 5%;
            width: 90%;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px; 
            z-index: 11; 
        }

        #room-id-input {
            width: calc(100% - 20px); 
            padding: 15px; 
            border-radius: 8px;
            border: 2px solid #ccc;
            box-sizing: border-box;
            text-align: center;
            font-size: 1.4em;
            background-color: white; 
        }
        
        #room-modal-enter-button {
            width: calc(100% - 20px);
            padding: 15px;
            background-color: #3f51b5; 
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.4em;
            font-weight: bold;
        }

        /* ------------------ 3. ãƒ«ãƒ¼ãƒ ä½œæˆå®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ« (ã‚³ãƒ¼ãƒ‰åŒ–) ------------------ */
        #room-created-modal-content-wrapper {
            background: transparent;
            box-shadow: none;
            aspect-ratio: 1.5; 
            max-width: 700px; 
        }

        #room-created-panel {
            background: #e91e63; 
            padding: 30px;
            border-radius: 10px;
            transform: skewX(-5deg); 
            width: 100%;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            position: absolute;
            height: 100%;
            box-sizing: border-box;
        }
        
        /* å†…éƒ¨è¦ç´ ã‚’é€†ã‚¹ã‚­ãƒ¥ãƒ¼ã§ã¾ã£ã™ãã« */
        #room-created-panel > * {
            transform: skewX(5deg); 
        }

        #room-created-panel h2 {
            color: white;
            font-size: 2.2em;
            margin-top: 10%;
            margin-bottom: 0;
        }

        .room-id-display {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10% auto;
            width: 80%;
        }

        #room-id-label {
            background: #f8bbd0; 
            border-radius: 10px 0 0 10px;
            padding: 15px 20px;
            font-weight: bold;
            color: #a33b66; 
            font-size: 1.2em;
            height: 100%;
            display: flex;
            align-items: center;
            box-sizing: border-box;
            white-space: nowrap; 
        }

        #displayed-room-id {
            background: #f8bbd0; 
            border: none;
            padding: 15px;
            font-size: 1.4em;
            text-align: left;
            flex-grow: 1;
            height: 100%;
            box-sizing: border-box;
        }
        
        #copy-button {
            background: #e91e63; 
            color: white;
            padding: 15px 20px;
            border: 3px solid white; 
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            height: 100%;
            box-sizing: border-box;
            white-space: nowrap;
        }

        .control-buttons-overlay {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15%;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        .control-buttons-overlay button {
            flex: 1;
            padding: 15px 25px;
            font-weight: bold;
            font-size: 1.4em;
            cursor: pointer;
            border-radius: 40px;
            border: none;
            white-space: nowrap;
        }

        #cancel-button {
            background: transparent;
            color: white;
            border: 3px solid white;
        }

        #enter-button {
            background: #4caf50; 
            color: white;
        }
        
        /* ------------------ 4. éŠã³æ–¹ãƒ¢ãƒ¼ãƒ€ãƒ« (ãƒ‡ã‚¶ã‚¤ãƒ³æ”¹å–„) ------------------ */

        /* how-to-play ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ç”»åƒã§è¡¨ç¤ºã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã«å¤‰æ›´ */
        #how-to-play-modal .modal-content-wrapper {
            background-image: url('./Images/how_to_play.PNG'); /* ã“ã“ã‚’å·®ã—æ›¿ãˆ */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 90%;
            max-width: 900px;
            aspect-ratio: 16/9; /* ç”»åƒã®ç¸¦æ¨ªæ¯”ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ä¸‹ã•ã„ */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 0; /* ç”»åƒè¡¨ç¤ºã®ãŸã‚ä½™ç™½ã¯ä¸è¦ */
            box-sizing: border-box;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸è¦ãªã®ã§éè¡¨ç¤ºã«ã™ã‚‹ï¼ˆclose ãƒœã‚¿ãƒ³ã®ã¿è¡¨ç¤ºï¼‰ */
        #how-to-play-modal .modal-content-wrapper > *:not(.close-button) {
            display: none;
        }

    </style>
</head>
<body>

    <div id="title-container">
        <button id="play-button" class="title-button-overlay" onclick="showPlayModal()"></button>
        <button id="how-to-play-button" class="title-button-overlay" onclick="showHowToPlayModal()"></button>
        <button id="tech-info-button" class="title-button-overlay" onclick="alert('æŠ€è¡“è§£èª¬ãƒšãƒ¼ã‚¸ã¸é·ç§»ã—ã¾ã™ã€‚ä»Šå›ã¯é·ç§»å…ˆãŒãªã„ãŸã‚ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸã€‚')"></button>
    </div>

    <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”¨BGMï¼ˆãƒ«ãƒ¼ãƒ—å†ç”Ÿï¼‰ -->
    <audio id="title-bgm" loop preload="auto">
        <source src="./Music/iwashiro_amakuchi.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- ãƒŸãƒ¥ãƒ¼ãƒˆ/éŸ³é‡ãƒœã‚¿ãƒ³ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ -->
    <button id="audio-toggle" title="éŸ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹" style="position:fixed; right:16px; top:16px; z-index:50; background:rgba(0,0,0,0.4); color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">ğŸ”ˆ</button>

    
<div id="play-modal" class="modal" onclick="closeModalOnClickOutside(event)">
        <div id="play-modal-content-wrapper" class="modal-content-wrapper">
            <span class="close-button" onclick="closeModal('play-modal')">&times;</span>

            <div id="play-option-public" class="play-modal-option-overlay" onclick="location.href='./match/match.html'"></div>
            <div id="play-option-private" class="play-modal-option-overlay" onclick="showRoomModalFromPlayModal()"></div>
        </div>
    </div>

    
<div id="room-modal" class="modal" onclick="closeModalOnClickOutside(event)">
        <div id="room-modal-content-wrapper" class="modal-content-wrapper">
            <span class="close-button" onclick="closeModal('room-modal')">&times;</span>

            <div id="room-create-button" class="room-modal-button-overlay" onclick="createRoom()"></div>
            <div id="room-join-button" class="room-modal-button-overlay" onclick="showJoinInput()"></div>
            
            <div id="join-input-area">
                <input type="text" id="room-id-input" placeholder="ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›">
                <button id="room-modal-enter-button" onclick="joinRoom()">å…¥å®¤</button>
            </div>
        </div>
    </div>
    
    
<div id="room-created-modal" class="modal" onclick="closeModalOnClickOutside(event)">
        <div id="room-created-modal-content-wrapper" class="modal-content-wrapper">
            <div id="room-created-panel">
                <span class="close-button" onclick="closeModal('room-created-modal')">&times;</span>
                <h2>éƒ¨å±‹ã‚’ä½œã‚Šã¾ã—ãŸï¼</h2>
                
                <div class="room-id-display">
                    <span id="room-id-label">ãƒ«ãƒ¼ãƒ ID</span>
                    <input type="text" id="displayed-room-id" value="XXXXXX" readonly>
                    <button id="copy-button" onclick="copyRoomId()">ã‚³ãƒ”ãƒ¼</button>
                </div>

                <div class="control-buttons-overlay">
                    <button id="cancel-button" onclick="closeModal('room-created-modal'); showPlayModal();">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button id="enter-button" onclick="location.href='./match/match.html'">ã¯ã„ã‚‹</button>
                </div>
            </div>
        </div>
    </div>

    
<div id="how-to-play-modal" class="modal" onclick="closeModalOnClickOutside(event)">
        <div class="modal-content-wrapper">
            <span class="close-button" onclick="closeModal('how-to-play-modal')">&times;</span>
            <h2>éŠã³æ–¹</h2>
            <p>
                **ãƒ«ãƒ¼ãƒ«**: æŒ‡ã§ã¯ã˜ã„ã¦ã€ç›¸æ‰‹ã®ã‚´ãƒ¼ãƒ«ã«ã‚·ãƒ¥ãƒ¼ãƒˆï¼<br>
                ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€æŒ‡ã®ãƒ•ãƒªãƒƒã‚¯ã®å¼·å¼±ã‚„è§’åº¦ãŒå‹æ•—ã‚’åˆ†ã‘ã¾ã™ã€‚
            </p>
            <p>
                **æ“ä½œ**: è‡ªåˆ†ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æŒ‡ã‚’ç½®ãã€å¼¾ããŸã„æ–¹å‘ã«ãƒ•ãƒªãƒƒã‚¯ï¼ˆæ‰•ã†ï¼‰ã™ã‚‹ã ã‘ã€‚<br>
                ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨æŒ‡åŠ æ¸›ã§ã€å¼·åŠ›ãªãƒ­ãƒ³ã‚°ã‚·ãƒ¥ãƒ¼ãƒˆã‚„ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ãªãƒ‘ã‚¹ã‚‚å¯èƒ½ã§ã™ã€‚
            </p>
            <p>
                **å‹åˆ©æ¡ä»¶**: è¦å®šæ™‚é–“å†…ã«ç›¸æ‰‹ã‚ˆã‚Šå¤šãå¾—ç‚¹ã™ã‚‹ã‹ã€è¨­å®šã•ã‚ŒãŸç‚¹æ•°ã«å…ˆã«åˆ°é”ã™ã‚‹ã¨å‹åˆ©ã§ã™ã€‚
            </p>
        </div>
    </div>

    <script>
        let currentRoomId = '';
        
        /**
         * ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡é–¢æ•°
         */
        function showModal(id) {
            document.getElementById(id).style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹æ©Ÿèƒ½
        function closeModalOnClickOutside(event) {
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ãŒã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒ†ãƒŠè‡ªèº« (.modal) ã§ã‚ã‚‹ã‹ç¢ºèªã™ã‚‹
            if (event.target.classList.contains('modal')) {
                closeModal(event.target.id);
            }
        }

        // ã€ŒéŠã¶ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
        function showPlayModal() {
            showModal('play-modal');
        }

        // ã€ŒéŠã³æ–¹ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
        function showHowToPlayModal() {
            showModal('how-to-play-modal');
        }

        // ã€Œå°‚ç”¨éƒ¨å±‹ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ (éŠã¶ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦ãƒ«ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã)
        function showRoomModalFromPlayModal() {
            closeModal('play-modal');
            showModal('room-modal');
            // å…¥å®¤å…¥åŠ›æ¬„ã‚’éè¡¨ç¤ºã«ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('join-input-area').style.display = 'none'; 
        }

        // ãƒ«ãƒ¼ãƒ ä½œæˆå‡¦ç† (ãƒ«ãƒ¼ãƒ ä½œæˆå®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º)
        function createRoom() {
            closeModal('room-modal');
            
            // å®Ÿéš›ã«ã¯ã“ã“ã§ã‚µãƒ¼ãƒãƒ¼é€šä¿¡ã‚’è¡Œã„ã€ãƒ«ãƒ¼ãƒ IDã‚’ç™ºè¡Œã—ã¾ã™ã€‚
            currentRoomId = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            // IDã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ã‚»ãƒƒãƒˆã—ã¦è¡¨ç¤º
            document.getElementById('displayed-room-id').value = currentRoomId;
            showModal('room-created-modal');
        }

        // ãƒ«ãƒ¼ãƒ IDã‚³ãƒ”ãƒ¼å‡¦ç†
        function copyRoomId() {
             const roomIdInput = document.getElementById('displayed-room-id');
             roomIdInput.select();
             document.execCommand('copy');
             alert('ãƒ«ãƒ¼ãƒ IDã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ: ' + currentRoomId);
        }


        // ã€Œéƒ¨å±‹ã«ã¯ã„ã‚‹ã€ã®å…¥åŠ›æ¬„è¡¨ç¤º
        function showJoinInput() {
            const inputArea = document.getElementById('join-input-area');
            // ãƒˆã‚°ãƒ«è¡¨ç¤º
            if (inputArea.style.display === 'flex') {
                inputArea.style.display = 'none';
            } else {
                inputArea.style.display = 'flex';
            }
        }

        // ãƒ«ãƒ¼ãƒ å‚åŠ å‡¦ç†
        function joinRoom() {
            const roomId = document.getElementById('room-id-input').value.trim();
            if (roomId.length > 0) {
                alert(`ãƒ«ãƒ¼ãƒ ID: ${roomId} ã§å…¥å®¤ã‚’è©¦ã¿ã¾ã™ã€‚\nãƒãƒƒãƒãƒ³ã‚°ç”»é¢ã¸é·ç§»ã—ã¾ã™ã€‚`);
                // å®Ÿéš›ã«ã¯ã‚µãƒ¼ãƒãƒ¼ã«IDã‚’é€ä¿¡ã—ã€ãƒãƒƒãƒãƒ³ã‚°ç”»é¢ã¸é·ç§»
                location.href = './match/match.html';
            } else {
                alert('ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        // ------------------ BGM åˆ¶å¾¡ ------------------
        const bgm = document.getElementById('title-bgm');
        const audioToggle = document.getElementById('audio-toggle');
        let hasStarted = false;

        // attempt to play (used after user interaction)
        function tryStartBgm() {
            if (hasStarted) return;
            // Start muted first to increase chance of autoplay succeeding on some browsers
            bgm.muted = true;
            const p = bgm.play();
            if (p && typeof p.then === 'function') {
                p.then(() => {
                    hasStarted = true;
                    // show muted icon until user unmutes
                    audioToggle.textContent = 'ğŸ”‡';
                }).catch(() => {
                    // play failed (autoplay blocked), keep it ready to play on user gesture
                    hasStarted = false;
                });
            }
        }

        // Toggle mute/unmute and ensure music plays after unmute
        audioToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            if (!hasStarted) {
                // user gesture: start and unmute
                bgm.muted = false;
                bgm.play().catch(() => {});
                hasStarted = true;
                audioToggle.textContent = 'ğŸ”Š';
                return;
            }

            bgm.muted = !bgm.muted;
            audioToggle.textContent = bgm.muted ? 'ğŸ”ˆ' : 'ğŸ”Š';
        });

        // Ensure user interactions on title buttons start the BGM (satisfies autoplay gesture requirement)
        ['play-button', 'how-to-play-button', 'tech-info-button'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('click', () => {
                    tryStartBgm();
                    // if already started and muted, unmute slightly so user hears immediately
                    if (hasStarted && bgm.muted) {
                        // do not force unmute; keep muted until user toggles
                    }
                });
            }
        });

        // Try starting BGM on first pointerdown/keydown anywhere on document (covers keyboard/touch/click)
        // For the very first gesture on the page, unmute and play immediately so users hear audio even if
        // autoplay was initially muted. This listener is removed after the first successful attempt.
        function onFirstGesture() {
            // Attempt to start and unmute so the first tap produces audible sound
            try {
                bgm.muted = false;
                const p = bgm.play();
                if (p && typeof p.then === 'function') {
                    p.then(() => {
                        hasStarted = true;
                        audioToggle.textContent = 'ğŸ”Š';
                    }).catch(() => {
                        // fallback: tryStartBgm() will attempt muted play
                        tryStartBgm();
                    });
                } else {
                    hasStarted = true;
                    audioToggle.textContent = 'ğŸ”Š';
                }
            } catch (e) {
                tryStartBgm();
            }
            // remove listeners after first gesture
            document.removeEventListener('pointerdown', onFirstGesture);
            document.removeEventListener('keydown', onFirstGesture);
        }

        document.addEventListener('pointerdown', onFirstGesture, { once: true });
        document.addEventListener('keydown', onFirstGesture, { once: true });
    </script>
</body>
</html>